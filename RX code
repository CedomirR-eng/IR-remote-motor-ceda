#include <IRremote.hpp>

#define IR_RX_PIN 12
int currentBrightness = 0;
bool pin9_enabled = false;
bool pin5_enabled = false;
unsigned long lastBlink = 0;
bool statusLedState = false;

void setup() {
  Serial.begin(9600);
  IrReceiver.begin(IR_RX_PIN);
  pinMode(9, OUTPUT);
  pinMode(5, OUTPUT);
  pinMode(2, OUTPUT);  // Status LED
  Serial.println("RX Ready - Fixed LED Logic");
}

void loop() {
  if (IrReceiver.decode()) {
    uint16_t address = IrReceiver.decodedIRData.address;
    uint16_t command = IrReceiver.decodedIRData.command;
    
    Serial.print("Addr: ");
    Serial.print(address);
    Serial.print(" Cmd: ");
    Serial.println(command);
    
    if (address == 7) {          // Brightness
      currentBrightness = command;
    } 
    else if (address == 1800) {  // Pin 9 button
      pin9_enabled = (command < 65000); // Button pressed = small value
    }
    else if (address == 1801) {  // Pin 5 button
      pin5_enabled = (command < 65000); // Button pressed = small value
    }
    
   
    analogWrite(9, pin9_enabled ? currentBrightness : 0);
    analogWrite(5, pin5_enabled ? currentBrightness : 0);
    
    Serial.print("Applied - Brightness: ");
    Serial.print(currentBrightness);
    Serial.print(" Pin9: ");
    Serial.print(pin9_enabled ? "ON" : "OFF");
    Serial.print(" Pin5: ");
    Serial.println(pin5_enabled ? "ON" : "OFF");
    
    IrReceiver.resume();
  }
  
  
  if (pin9_enabled || pin5_enabled) {
    if (statusLedState && millis() - lastBlink > 100) {  
      statusLedState = false;
      digitalWrite(2, LOW);
      lastBlink = millis();
    }
    else if (!statusLedState && millis() - lastBlink > 300) { 
      statusLedState = true;
      digitalWrite(2, HIGH);
      lastBlink = millis();
    }
  } else {
    digitalWrite(2, LOW);  // Off when no LEDs active
    statusLedState = false;  // Reset state
  }
}
